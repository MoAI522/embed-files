# ef (embed files) CLIツール仕様書

## 1. 概要

efは、プロンプトテンプレートファイル内で指定されたファイルやディレクトリの内容を展開し、LLMへの入力に適した形式に変換するCLIツールです。

## 2. 基本機能

### 2.1 コマンド実行
- コマンド形式: `ef <プロンプトテンプレートファイルのパス>`
- 例: `ef prompt.txt`
- オプション:
  - `--debug, -d`: デバッグ情報を表示

### 2.2 プロンプトテンプレートの構文
- ファイル埋め込み指示子（glob）: `#ef <ファイルパス>`
  - 例: `#ef src/components/*.tsx`
- ファイル埋め込み指示子（正規表現）: `#efr <正規表現パターン>`
  - 例: `#efr ^src/.*\.controller\.ts$`
- 全ての'#'で始まる行を指示子として解析する
- 指示子として認識されなかった'#'で始まる行は通常のテキストとして処理される
- ファイルパスはテンプレートファイルが存在するディレクトリを起点として解決する
- 絶対パスの場合はそのパスを直接使用する
- 引数のない指示子（`#ef`や`#efr`のみの行）は通常のテキストとして処理される
- 指示子の後のスペース区切りの文字列は全て1つの引数として処理される
- 例: `#ef src/*.rs test/*.rs` は "src/*.rs test/*.rs" を1つのパターンとして処理

### 2.3 出力フォーマット
- .eftemplateファイルに定義された埋め込み文字列テンプレートに従って出力
- テンプレート内で使用可能な変数:
  - `{filePath}`: ファイルパス
  - `{language}`: ファイル種別に応じた言語識別子
  - `{content}`: ファイル内容

## 3. .eftemplate ファイル

### 3.1 基本仕様
- プレーンテキストファイル
- 出力フォーマットをそのまま記述
- 変数は`{filePath}`, `{language}`, `{content}`の形式で参照

### 3.2 検索順序
1. カレントディレクトリの.eftemplate
2. 親ディレクトリを順に探索
3. 最初に見つかった.eftemplateを使用

### 3.3 デフォルトテンプレート
.eftemplateが見つからない場合は以下のデフォルトフォーマットを使用:
```
{filePath}
```{language}
{content}
```
```

### 3.4 .eftemplateの例
```
ファイル: {filePath}
==========
コード ({language}):
```{language}
{content}
```
==========
```

## 4. 言語識別子
- .tsx -> tsx
- .js -> javascript
- .md -> markdown
- その他の拡張子も適切な言語識別子にマッピング(外部ライブラリを使用？)

## 5. エラー処理
以下の場合にエラーを出力し、プログラムを終了します：

### 5.1 エラー種別
- IoError: ファイルの読み書きに失敗した場合
- InvalidGlobPattern: `#ef`に指定されたglobパターンの構文が不正な場合
- InvalidRegexPattern: `#efr`に指定された正規表現の構文が不正な場合

### 5.2 警告
以下の場合は警告を出力し、処理を継続します：
- 指定されたファイルが見つからない場合

### 5.3 デバッグモード
`--debug`オプションが指定された場合、エラーの詳細な原因情報を表示します。

## 6. 制約事項
- .eftemplateファイルが見つからない場合はデフォルトテンプレートを使用
